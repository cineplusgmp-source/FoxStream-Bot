<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fox Stream Bot</title>
<!-- Fuente y reset simple -->
<style>
  :root{
    --bg:#f3f5f7; --card:#ffffff; --text:#0f172a; --muted:#64748b;
    --brand:#2563eb; --brand-weak:#e0ecff; --ok:#16a34a; --err:#dc2626;
    --bubble:#e9f0ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--text); font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial;
    display:flex; justify-content:center;
  }
  /* Contenedor tipo chat: se ve igual en m√≥vil y desktop (m√°x 480px) */
  .app{
    width:100%; max-width:480px; min-height:100vh; padding:16px; display:flex; flex-direction:column; gap:12px;
  }
  header{ text-align:center; }
  h1{ font-size:1.6rem; margin:.2rem 0 .1rem }
  .sub{ color:var(--muted); font-size:.9rem }

  .chat{
    background:var(--card); border-radius:16px; padding:12px; flex:1; display:flex; flex-direction:column; gap:10px;
    box-shadow:0 2px 12px rgba(0,0,0,.06);
  }
  .row{ display:flex; gap:8px; }
  .bot{ justify-content:flex-start; }
  .me{ justify-content:flex-end; }
  .bubble{
    max-width:80%; padding:10px 12px; border-radius:14px; background:var(--bubble);
  }
  .me .bubble{ background:#e5e7eb; }
  .muted{ color:var(--muted) }
  .ok{ color:var(--ok); font-weight:600 }
  .err{ color:var(--err); font-weight:600 }

  .choices{ display:flex; flex-direction:column; gap:8px; }
  .chip{
    display:inline-block; padding:10px 12px; border-radius:12px; border:1px solid var(--brand);
    color:var(--brand); background:var(--brand-weak); cursor:pointer; user-select:none;
  }
  .inputBar{
    display:flex; gap:8px; align-items:center; background:var(--card); padding:10px; border-radius:12px;
    box-shadow:0 2px 12px rgba(0,0,0,.06);
  }
  input[type=text]{
    flex:1; border:none; outline:none; font:inherit; padding:8px 6px;
  }
  button{
    background:var(--brand); color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600;
  }
  button:disabled{ opacity:.6; cursor:not-allowed }
  /* micro mejoras en desktop */
  @media (min-width: 700px){
    body{ padding:24px 0 }
  }
</style>
</head>
<body>
  <main class="app">
    <header>
      <h1>Fox Stream Bot</h1>
      <div class="sub">Soporte autom√°tico 24/7</div>
    </header>

    <section id="chat" class="chat" aria-live="polite"></section>

    <form id="bar" class="inputBar" autocomplete="off">
      <input id="msg" type="text" placeholder='Escribe aqu√≠‚Ä¶ (ej: hola)' />
      <button id="send" type="submit">Enviar</button>
    </form>
  </main>

<script>
/* ============================
   1) Lista de clientes permitidos
   - Reemplaza estos tel√©fonos por los tuyos (sin espacios ni guiones).
   - Acepta con o sin +, y con o sin c√≥digo de pa√≠s; normalizamos.
============================ */
const CLIENTES = [
  "5195602221","50232383893","51990037255","51910303715","519457451959","51908434802",
  "519602022891","519563022221","519607518762","519680149842","510743023389","502333238393",
  "518985073553","505809875353","506838475353","50583208221","502333283093","50584469802",
  "519482141112","502333283093","519432031205","519423021035","519293358940","519023358940",
  "502333283093","519850622221","519563022221","519808322006"
];

/* ============================
   2) Estado de conversaci√≥n
============================ */
let estado = {
  fase: "inicio",      // inicio -> esperando_tel -> verificado -> menu -> tarea -> fin
  telefono: null
};

const chat = document.getElementById('chat');
const input = document.getElementById('msg');
const form = document.getElementById('bar');

/* Utilidades */
const sleep = (ms)=> new Promise(r=>setTimeout(r, ms));
const norm = (raw) => (raw||"")
  .replace(/[^\d+]/g,'')     // deja d√≠gitos y +
  .replace(/^00/,'+')
  .replace(/^(\+?51|\+?502)?/, '') // quita c√≥digo pa√≠s m√°s usados por ti (ajusta seg√∫n necesites)
  .replace(/^\+/, '')        // quita + si qued√≥ al inicio
  .replace(/^0+/, '');       // quita ceros iniciales

function addBot(text, html=false){
  const row = document.createElement('div'); row.className='row bot';
  const b = document.createElement('div'); b.className='bubble';
  if(html){ b.innerHTML = text } else { b.textContent = text }
  row.appendChild(b); chat.appendChild(row); chat.scrollTop = chat.scrollHeight;
}
function addUser(text){
  const row = document.createElement('div'); row.className='row me';
  const b = document.createElement('div'); b.className='bubble'; b.textContent = text;
  row.appendChild(b); chat.appendChild(row); chat.scrollTop = chat.scrollHeight;
}
function addChoices(items){
  const row = document.createElement('div'); row.className='row bot';
  const b = document.createElement('div'); b.className='bubble';
  const box = document.createElement('div'); box.className='choices';
  items.forEach(({label, value})=>{
    const chip = document.createElement('div'); chip.className='chip'; chip.textContent = label;
    chip.onclick = ()=> onChoice(value, label);
    box.appendChild(chip);
  });
  b.appendChild(box); row.appendChild(b); chat.appendChild(row); chat.scrollTop = chat.scrollHeight;
}

/* ============================
   3) Flujo de conversaci√≥n
============================ */
function resetToMenu(){
  estado.fase = "menu";
  addChoices([
    {label:"1) C√≥digo de acceso temporal", value:"codigo"},
    {label:"2) Actualizar tu Hogar",       value:"hogar"},
    {label:"3) Nueva solicitud de inicio (TV)", value:"inicio"}
  ]);
}

function inicio(){
  chat.innerHTML = '';
  addBot('üëã ¬°Hola! Escribe tu n√∫mero de tel√©fono para validar acceso.', true);
  estado = { fase: "inicio", telefono: null };
  input.placeholder = 'Escribe aqu√≠‚Ä¶ (ej: hola)';
}

async function onMessage(text){
  const msg = text.trim();
  if(!msg) return;

  // Mostrar yo
  addUser(msg);

  if(estado.fase === "inicio"){
    if(msg.toLowerCase() === 'hola'){
      estado.fase = "esperando_tel";
      await sleep(200);
      addBot('Escribe tu n√∫mero de tel√©fono para validar acceso.');
      input.placeholder = 'Tu n√∫mero (solo d√≠gitos)';
    }else{
      addBot('Escribe <b>hola</b> para empezar.', true);
    }
    return;
  }

  if(estado.fase === "esperando_tel"){
    const tel = norm(msg);
    if(!tel){ addBot('Formato no v√°lido. Intenta nuevamente.'); return; }

    const existe = CLIENTES.map(norm).includes(tel);
    if(existe){
      estado.fase = "verificado"; estado.telefono = tel;
      addBot('‚úÖ N√∫mero verificado. ¬°Bienvenido!');
      await sleep(250);
      resetToMenu();
    }else{
      addBot('‚ùå Tu n√∫mero no est√° registrado. Contacta al administrador.');
      await sleep(250);
      addBot('Escribe <b>hola</b> para volver al men√∫ principal.', true);
      estado.fase = "fin";
    }
    return;
  }

  if(estado.fase === "menu"){
    // permitir que el usuario tambi√©n escriba 1/2/3
    const m = msg.toLowerCase();
    if(['1','codigo','c√≥digo','codigo de acceso temporal','c√≥digo de acceso temporal'].includes(m)) return onChoice('codigo','C√≥digo de acceso temporal');
    if(['2','hogar','actualizar tu hogar'].includes(m)) return onChoice('hogar','Actualizar tu Hogar');
    if(['3','inicio','nueva solicitud de inicio','nueva solicitud de inicio (tv)','tv'].includes(m)) return onChoice('inicio','Nueva solicitud de inicio (TV)');
    addBot('Elige una opci√≥n tocando un bot√≥n o escribe 1, 2 o 3.');
    return;
  }

  if(estado.fase === "tarea" || estado.fase === "fin"){
    if(msg.toLowerCase() === 'hola'){ return inicio(); }
  }
}

async function onChoice(value,label){
  addUser(label);
  estado.fase = "tarea";

  // Aqu√≠ simula la respuesta. Luego integraremos el backend real.
  await sleep(300);
  if(value==='codigo'){
    addBot('üîê En unos momentos te enviaremos el c√≥digo de acceso temporal a tu TV / correo asociado.');
  }
  if(value==='hogar'){
    addBot('üè† Se program√≥ la actualizaci√≥n de tu Hogar. Si la TV lo solicita, confirma desde la app.');
  }
  if(value==='inicio'){
    addBot('üì∫ Te enviaremos un enlace de inicio de sesi√≥n a tu email/WhatsApp para activar tu TV.');
  }

  await sleep(250);
  addBot('Escribe <b>hola</b> para volver al men√∫ principal.', true);
  estado.fase = "fin";
}

/* ============================
   4) Arranque
============================ */
inicio();

form.addEventListener('submit', (e)=>{
  e.preventDefault();
  const text = input.value;
  input.value = '';
  onMessage(text);
});
</script>
</body>
</html>

